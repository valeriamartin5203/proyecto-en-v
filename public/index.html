<template>
  <div class="container mt-5">
    <h1 class="text-center mb-4">Agenda de Tareas</h1>

    <div class="card p-4 shadow">
      <div class="row g-2">
        <div class="col-md-5">
          <input v-model="titulo" type="text" class="form-control" placeholder="TÃ­tulo">
        </div>

        <div class="col-md-4">
          <input v-model="fecha" type="date" class="form-control">
        </div>

        <div class="col-md-3 d-grid">
          <button @click="agregarNota" class="btn btn-primary">
            Agregar
          </button>
        </div>
      </div>

      <hr>

      <div class="row mb-3">
        <div class="col-md-6">
          <label class="form-label">Elegir sonido:</label>
          <select v-model="sonidoSeleccionado" @change="guardarSonido" class="form-select">
            <option value="sonido1.mp3">Sonido 1</option>
            <option value="sonido2.mp3">Sonido 2</option>
          </select>
        </div>

        <div class="col-md-6 d-flex align-items-end">
          <button @click="probarSonido" class="btn btn-secondary w-100">
            ðŸ”Š Probar sonido
          </button>
        </div>
      </div>

      <ul class="list-group">
        <li 
          v-for="(nota, index) in notas" 
          :key="index"
          class="list-group-item d-flex justify-content-between align-items-center"
          :class="{'list-group-item-danger': nota.fecha === hoy}"
        >
          {{ nota.titulo }} - {{ nota.fecha }}

          <button @click="eliminarNota(index)" class="btn btn-sm btn-danger">
            Eliminar
          </button>
        </li>
      </ul>

    </div>
  </div>
</template>

<script>
export default {
  data() {
    return {
      titulo: "",
      fecha: "",
      notas: JSON.parse(localStorage.getItem("notas")) || [],
      sonidoSeleccionado: localStorage.getItem("sonido") || "sonido1.mp3",
      hoy: new Date().toISOString().split("T")[0],
      audio: null
    }
  },

  mounted() {
    this.audio = new Audio(`/src/assets/sonidos/${this.sonidoSeleccionado}`)
    this.verificarNotificaciones()
    setInterval(this.verificarNotificaciones, 60000)
  },

  methods: {

    agregarNota() {
      if (!this.titulo || !this.fecha) {
        alert("Completa todos los campos")
        return
      }

      this.notas.push({
        titulo: this.titulo,
        fecha: this.fecha,
        notificado: false
      })

      this.guardarNotas()

      this.titulo = ""
      this.fecha = ""
    },

    eliminarNota(index) {
      this.notas.splice(index, 1)
      this.guardarNotas()
    },

    guardarNotas() {
      localStorage.setItem("notas", JSON.stringify(this.notas))
    },

    guardarSonido() {
      localStorage.setItem("sonido", this.sonidoSeleccionado)
      this.audio = new Audio(`/src/assets/sonidos/${this.sonidoSeleccionado}`)
    },

    probarSonido() {
      this.audio.play()
    },

    verificarNotificaciones() {
      this.hoy = new Date().toISOString().split("T")[0]

      this.notas.forEach((nota) => {
        if (nota.fecha === this.hoy && !nota.notificado) {

          alert("Hoy vence: " + nota.titulo)
          this.audio.play()

          nota.notificado = true
          this.guardarNotas()
        }
      })
    }
  }
}
</script>

<style>
body {
  font-family: 'Poppins', sans-serif;
  background: #f4f6f9;
}
</style>